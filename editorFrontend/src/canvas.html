<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Editor with Autocompletion, Linting, and More</title>
    <link rel="stylesheet" href="../node_modules/flowbite/dist/flowbite.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/dracula.min.css">
    <link rel="stylesheet" href="index.css">

    <style>
        .CodeMirror {
            height: 90vh;
            border: 1px solid #ddd;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body class="dark:bg-gray-900 h-screen overflow-hidden">
    <!-- Sidebar -->
    <aside id="sidebar-multi-level-sidebar" class="fixed left-0 z-40 w-64 h-screen transition-transform -translate-x-full sm:translate-x-0" aria-label="Sidebar">
        <div class="h-full px-3 py-4 overflow-y-auto bg-gray-50 bg-gray-800">
            <ul class="space-y-2 font-medium">
                <li>
                    <a href="#" class="flex items-center p-2 text-gray-900 rounded-lg text-white hover:bg-gray-100 hover:bg-gray-700 group">
                        <span class="ms-3">Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="canvas.html" class="flex items-center p-2 text-gray-900 rounded-lg text-white hover:bg-gray-100 hover:bg-gray-700 group">
                        <span class="ms-3">Public Repository</span>
                    </a>
                </li>
            </ul>
        </div>
    </aside>

    <div class="p-4 sm:ml-64">
        <!-- Language Selector -->
        <div class="relative mb-4">
            <select id="languageSelect" class="block w-full p-2 border rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600">
                <option value="javascript">JavaScript</option>
                <option value="python">Python</option>
                <option value="htmlmixed">HTML</option>
                <option value="css">CSS</option>
                <option value="php">PHP</option>
                <option value="ruby">Ruby</option>
                <option value="go">Go</option>
            </select>
        </div>

        <!-- Textarea for CodeMirror -->
        <div class="relative">
            <textarea id="editor" placeholder="Start typing your code..."></textarea>
        </div>
    </div>

    <!-- Main content -->
    <script src="../node_modules/flowbite/dist/flowbite.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/php/php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/ruby/ruby.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/go/go.min.js"></script>

    <!-- Addons for autocompletion, linting, and more -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/show-hint.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/show-hint.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/hint/javascript-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/lint/lint.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/lint/lint.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/search/search.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/search/searchcursor.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/dialog/dialog.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/dialog/dialog.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/fold/foldcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/fold/foldgutter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/fold/brace-fold.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/fold/comment-fold.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/comment/comment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/comment/continuecomment.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/history/history.min.js"></script>

    <!-- Inline Script to initialize CodeMirror with autocompletion, linting, search & replace, and more -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const editorElement = document.getElementById('editor');
            const languageSelect = document.getElementById('languageSelect');

            // Create a CodeMirror instance
            const editor = CodeMirror.fromTextArea(editorElement, {
                lineNumbers: true,
                mode: languageSelect.value, // Set the initial mode
                theme: 'dracula',
                autoCloseBrackets: true,
                matchBrackets: true,
                lineWrapping: true,
                foldGutter: true,
                gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter", "CodeMirror-lint-markers"], // Gutter for folding & linting
                lint: true, // Enable linting
                extraKeys: {
                    "Ctrl-Space": "autocomplete", // Enable autocompletion with Ctrl+Space
                    "Ctrl-F": "find", // Enable search
                    "Ctrl-H": "replace", // Enable search & replace
                    "Ctrl-Z": function(cm) { cm.undo(); }, // Undo
                    "Ctrl-Y": function(cm) { cm.redo(); }  // Redo
                },
            });

            // Update the CodeMirror mode when the language is changed
            languageSelect.addEventListener('change', function () {
                const selectedMode = this.value;
                editor.setOption('mode', selectedMode);
            });

            // Example of adding linting rules (You can configure your own rules)
            CodeMirror.registerHelper("lint", "javascript", function(text) {
                const found = [];
                if (!text.includes('console')) {
                    found.push({
                        message: "You must use 'console' in your code",
                        severity: "error",
                        from: CodeMirror.Pos(0, 0),
                        to: CodeMirror.Pos(1, 0)
                    });
                }
                return found;
            });
        });
    </script>
</body>
</html>
